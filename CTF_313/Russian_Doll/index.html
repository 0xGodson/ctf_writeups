<code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #FF8000">//&nbsp;Web02&nbsp;Challenge&nbsp;"Russian&nbsp;Doll"<br /><br /></span><span style="color: #007700">include(</span><span style="color: #DD0000">'flag.php'</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">error_reporting</span><span style="color: #007700">(</span><span style="color: #0000BB">0</span><span style="color: #007700">);<br /><br />if(!isset(</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">'text'</span><span style="color: #007700">])){<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">highlight_file</span><span style="color: #007700">(</span><span style="color: #0000BB">__FILE__</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;die();<br />}<br /><br /><br /></span><span style="color: #FF8000">//&nbsp;Stage&nbsp;1<br /></span><span style="color: #0000BB">$text&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">'text'</span><span style="color: #007700">];<br />if(@</span><span style="color: #0000BB">file_get_contents</span><span style="color: #007700">(</span><span style="color: #0000BB">$text</span><span style="color: #007700">)!==</span><span style="color: #DD0000">"–ü—Ä–∏–≤–µ—Ç&nbsp;—Ö–∞–∫–µ—Ä"</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;die(</span><span style="color: #DD0000">"You&nbsp;must&nbsp;speak&nbsp;my&nbsp;language&nbsp;a&nbsp;different&nbsp;way!"</span><span style="color: #007700">);<br />}<br /><br />echo&nbsp;</span><span style="color: #DD0000">"Stage&nbsp;1&nbsp;is&nbsp;complete!&nbsp;You&nbsp;unlocked&nbsp;the&nbsp;key:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$secretkey&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;Stage&nbsp;2<br /></span><span style="color: #0000BB">$key1&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">'key1'</span><span style="color: #007700">];<br /></span><span style="color: #0000BB">$keyId&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">1337</span><span style="color: #007700">;<br /><br />if&nbsp;(</span><span style="color: #0000BB">intval</span><span style="color: #007700">(</span><span style="color: #0000BB">$key1</span><span style="color: #007700">)&nbsp;!==&nbsp;</span><span style="color: #0000BB">$keyId&nbsp;</span><span style="color: #007700">||&nbsp;</span><span style="color: #0000BB">$key1&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #0000BB">$keyId</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;die(</span><span style="color: #DD0000">"—Ö–∞—Ö–∞,&nbsp;—ç—Ç–æ&nbsp;—Å—Ç—Ä–æ–≥–æ&nbsp;–Ω–µ&nbsp;—Å—Ä–∞–±–æ—Ç–∞–µ—Ç"</span><span style="color: #007700">);<br />}<br /><br />echo&nbsp;</span><span style="color: #DD0000">"Stage&nbsp;2&nbsp;is&nbsp;complete!&nbsp;Keep&nbsp;Going!\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">////////////////////////////////<br />//&nbsp;CTF&nbsp;313&nbsp;MID&nbsp;CON&nbsp;EDIT!<br />////////////////////////////////<br />//&nbsp;Stage&nbsp;3<br />//$token&nbsp;=&nbsp;time();<br />//$tokenDeath&nbsp;=&nbsp;$token&nbsp;+&nbsp;24*60*60;<br /><br />//&nbsp;CTF&nbsp;313&nbsp;EDIT<br />//if&nbsp;(($tokenDeath&nbsp;-&nbsp;time())&nbsp;&lt;=&nbsp;0)&nbsp;{<br />//&nbsp;&nbsp;&nbsp;&nbsp;if(substr(hash("sha256",&nbsp;$keyId&nbsp;+&nbsp;$token&nbsp;.&nbsp;$secretkey),&nbsp;5,&nbsp;25)&nbsp;==&nbsp;$hash)&nbsp;{<br />//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$keyId&nbsp;=&nbsp;$_GET['keyId'];<br />//&nbsp;&nbsp;&nbsp;&nbsp;}<br />//}&nbsp;else&nbsp;{<br />//&nbsp;&nbsp;&nbsp;&nbsp;die("–í–∞—à&nbsp;—Ç–æ–∫–µ–Ω&nbsp;–º–µ—Ä—Ç–≤,&nbsp;–∫–∞–∫&nbsp;–∏&nbsp;—ç—Ç–∞&nbsp;–ø–æ–ø—ã—Ç–∫–∞");<br />//}<br /><br />//&nbsp;Stage&nbsp;3<br /></span><span style="color: #0000BB">$hash&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">'hash'</span><span style="color: #007700">];<br /></span><span style="color: #0000BB">$token&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">intval</span><span style="color: #007700">(</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">'token'</span><span style="color: #007700">]);<br /><br />if(</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">hash</span><span style="color: #007700">(</span><span style="color: #DD0000">"sha256"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$keyId&nbsp;</span><span style="color: #007700">+&nbsp;</span><span style="color: #0000BB">$token&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$secretkey</span><span style="color: #007700">),&nbsp;</span><span style="color: #0000BB">5</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">25</span><span style="color: #007700">)&nbsp;==&nbsp;</span><span style="color: #0000BB">$hash</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$keyId&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">'keyId'</span><span style="color: #007700">];<br />}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;die(</span><span style="color: #DD0000">"–í–∞—à&nbsp;—Ç–æ–∫–µ–Ω&nbsp;–º–µ—Ä—Ç–≤,&nbsp;–∫–∞–∫&nbsp;–∏&nbsp;—ç—Ç–∞&nbsp;–ø–æ–ø—ã—Ç–∫–∞"</span><span style="color: #007700">);<br />}<br /><br />echo&nbsp;</span><span style="color: #DD0000">"Stage&nbsp;3&nbsp;is&nbsp;complete!&nbsp;You&nbsp;defeated&nbsp;death,&nbsp;for&nbsp;now...\n"</span><span style="color: #007700">;<br /><br /><br /></span><span style="color: #FF8000">//&nbsp;Final&nbsp;Stage<br /></span><span style="color: #0000BB">$key2&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">69</span><span style="color: #007700">;<br />if(</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$keyId</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$key2</span><span style="color: #007700">)&nbsp;!==&nbsp;</span><span style="color: #0000BB">sha1</span><span style="color: #007700">(</span><span style="color: #0000BB">$keyId</span><span style="color: #007700">)){<br />&nbsp;&nbsp;&nbsp;&nbsp;die(</span><span style="color: #DD0000">"—Ç—ã&nbsp;–Ω–µ&nbsp;–º–æ–∂–µ—à—å&nbsp;—Å–¥–∞—Ç—å—Å—è&nbsp;—Å–µ–π—á–∞—Å!"</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #FF8000">//&nbsp;Final&nbsp;Stage<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #DD0000">"Final&nbsp;stage&nbsp;is&nbsp;complete&nbsp;Where&nbsp;da&nbsp;flag&nbsp;homie?&nbsp;üí©\n"</span><span style="color: #007700">;<br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /></span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">"Content-Type:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$flag</span><span style="color: #007700">);<br /></span>
</span>
</code>